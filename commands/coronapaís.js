const Discord = require('discord.js');
const superagent = require('node-fetch');
const config = require('../json/config.json');
const moment = require('moment');
moment.locale('pt-BR');

exports.run = async (bot,message, args) => {
    try {
        if (args.length === 0) return message.reply("Mencione um país");
        let country = args[0];
        let countries = [
            "afghanistan",
            "albania",
            "algeria",
            "andorra",
            "angola",
            "antigua-and-barbuda",
            "argentina",
            "armenia",
            "australia",
            "austria",
            "azerbaijan",
            "bahamas",
            "bahrain",
            "bangladesh",
            "barbados",
            "belarus",
            "belgium",
            "belize",
            "benin",
            "bhutan",
            "bolivia",
            "bosnia-and-herzegovina",
            "botswana",
            "brazil",
            "brunei",
            "bulgaria",
            "burkina-faso",
            "burundi",
            "cambodia",
            "cameroon",
            "canada",
            "cape-verde",
            "central-african-republic",
            "chad",
            "chile",
            "china",
            "colombia",
            "comoros",
            "congo-brazzaville",
            "congo-kinshasa",
            "costa-rica",
            "croatia",
            "cuba",
            "cyprus",
            "czech-republic",
            "cote-divoire",
            "denmark",
            "djibouti",
            "dominica",
            "dominican-republic",
            "ecuador",
            "egypt",
            "el-salvador",
            "equatorial-guinea",
            "eritrea",
            "estonia",
            "ethiopia",
            "fiji",
            "finland",
            "france",
            "gabon",
            "gambia",
            "georgia",
            "germany",
            "ghana",
            "greece",
            "grenada",
            "guatemala",
            "guinea",
            "guinea-bissau",
            "guyana",
            "haiti",
            "holy-see-vatican-city-state",
            "honduras",
            "hungary",
            "iceland",
            "india",
            "indonesia",
            "iran",
            "iraq",
            "ireland",
            "israel",
            "italy",
            "jamaica",
            "japan",
            "jordan",
            "kazakhstan",
            "kenya",
            "korea-south",
            "kuwait",
            "kyrgyzstan",
            "lao-pdr",
            "latvia",
            "lebanon",
            "lesotho",
            "liberia",
            "libya",
            "liechtenstein",
            "lithuania",
            "luxembourg",
            "macao-sar-china",
            "macedonia",
            "madagascar",
            "malawi",
            "malaysia",
            "maldives",
            "mali",
            "malta",
            "marshall-islands",
            "mauritania",
            "mauritius",
            "mexico",
            "moldova",
            "monaco",
            "mongolia",
            "montenegro",
            "morocco",
            "mozambique",
            "myanmar",
            "namibia",
            "nepal",
            "netherlands",
            "new-zealand",
            "nicaragua",
            "niger",
            "nigeria",
            "norway",
            "oman",
            "pakistan",
            "palestine",
            "panama",
            "papua-new-guinea",
            "paraguay",
            "peru",
            "philippines",
            "poland",
            "portugal",
            "qatar",
            "kosovo",
            "romania",
            "russia",
            "rwanda",
            "réunion",
            "saint-kitts-and-nevis",
            "saint-lucia",
            "saint-vincent-and-the-grenadines",
            "samoa",
            "san-marino",
            "sao-tome-and-principe",
            "saudi-arabia",
            "senegal",
            "serbia",
            "seychelles",
            "sierra-leone",
            "singapore",
            "slovakia",
            "slovenia",
            "solomon-islands",
            "somalia",
            "south-africa",
            "south-sudan",
            "spain",
            "sri-lanka",
            "sudan",
            "suriname",
            "swaziland",
            "sweden",
            "switzerland",
            "syria",
            "taiwan",
            "tajikistan",
            "tanzania",
            "thailand",
            "timor-leste",
            "togo",
            "trinidad-and-tobago",
            "tunisia",
            "turkey",
            "uganda",
            "ukraine",
            "united-arab-emirates",
            "united-kingdom",
            "united-states",
            "uruguay",
            "uzbekistan",
            "vanuatu",
            "venezuela",
            "vietnam",
            "western-sahara",
            "yemen",
            "zambia",
            "zimbabwe"
        ];

        if (!countries.includes(country.toLowerCase())) {
            return message.reply("Esse país não existe não man, veja o `z.help coronapaís`")
        }

        await superagent("https://api.covid19api.com/summary")
            .then(res => res.json())
            .then(json => {
                const countryData = json.Countries.filter(jsonCountry => jsonCountry.Slug === country.toLowerCase())[0];

                let embed = new Discord.RichEmbed()
                    .setColor('#ff1111')
                    .setTitle('Corona Vírus')
                    .setURL('https://documenter.getpostman.com/view/10808728/SzS8rjbc')
                    .setDescription(`Estatísticas do coronga em ${countryData.Country}`)
                    .setThumbnail('https://dfcby4322olzt.cloudfront.net/wp-content/uploads/2020/03/1800x1200_coronavirus_1.jpg')
                    .addField('Novos casos:\u200B', countryData.NewConfirmed, true)
                    .addField('Total de casos:\u200B', countryData.TotalConfirmed, true)
                    .addField('Novas mortes:\u200B', countryData.NewDeaths, true)
                    .addField('Total de mortes:\u200B', countryData.TotalDeaths, true)
                    .addField('Novas recuperações:\u200B', countryData.NewRecovered, true)
                    .addField('Total de recuperados:\u200B', countryData.TotalRecovered, true)
                    .addField('Data de publicação:\u200B', moment(countryData.Date).format('DD/MM/YYYY'), true)
                    .setImage('https://cdn.startupi.com.br/wp-content/uploads/2018/09/startup-countryData.jpg')
                    .setTimestamp()
                    .setFooter('Corona Vírus', 'https://imagepng.org/wp-content/uploads/2018/08/alerta.png');

                return message.channel.send(embed);
            });
    } catch (err) {
        return message.channel.send('A API do corona está fora do ar, tente mais tarde.');
    };  
}

exports.help = {
    name: "coronapaís",
    description: `\`${config.prefix}coronapaís {país}\` mostra estatísticas do corona vírus no país. Lista de países:
    afghanistan,
    albania,
    algeria,
    andorra,
    angola,
    antigua-and-barbuda,
    argentina,
    armenia,
    australia,
    austria,
    azerbaijan,
    bahamas,
    bahrain,
    bangladesh,
    barbados,
    belarus,
    belgium,
    belize,
    benin,
    bhutan,
    bolivia,
    bosnia-and-herzegovina,
    botswana,
    brazil,
    brunei,
    bulgaria,
    burkina-faso,
    burundi,
    cambodia,
    cameroon,
    canada,
    cape-verde,
    central-african-republic,
    chad,
    chile,
    china,
    colombia,
    comoros,
    congo-brazzaville,
    congo-kinshasa,
    costa-rica,
    croatia,
    cuba,
    cyprus,
    czech-republic,
    cote-divoire,
    denmark,
    djibouti,
    dominica,
    dominican-republic,
    ecuador,
    egypt,
    el-salvador,
    equatorial-guinea,
    eritrea,
    estonia,
    ethiopia,
    fiji,
    finland,
    france,
    gabon,
    gambia,
    georgia,
    germany,
    ghana,
    greece,
    grenada,
    guatemala,
    guinea,
    guinea-bissau,
    guyana,
    haiti,
    holy-see-vatican-city-state,
    honduras,
    hungary,
    iceland,
    india,
    indonesia,
    iran,
    iraq,
    ireland,
    israel,
    italy,
    jamaica,
    japan,
    jordan,
    kazakhstan,
    kenya,
    korea-south,
    kuwait,
    kyrgyzstan,
    lao-pdr,
    latvia,
    lebanon,
    lesotho,
    liberia,
    libya,
    liechtenstein,
    lithuania,
    luxembourg,
    macao-sar-china,
    macedonia,
    madagascar,
    malawi,
    malaysia,
    maldives,
    mali,
    malta,
    marshall-islands,
    mauritania,
    mauritius,
    mexico,
    moldova,
    monaco,
    mongolia,
    montenegro,
    morocco,
    mozambique,
    myanmar,
    namibia,
    nepal,
    netherlands,
    new-zealand,
    nicaragua,
    niger,
    nigeria,
    norway,
    oman,
    pakistan,
    palestine,
    panama,
    papua-new-guinea,
    paraguay,
    peru,
    philippines,
    poland,
    portugal,
    qatar,
    kosovo,
    romania,
    russia,
    rwanda,
    réunion,
    saint-kitts-and-nevis,
    saint-lucia,
    saint-vincent-and-the-grenadines,
    samoa,
    san-marino,
    sao-tome-and-principe,
    saudi-arabia,
    senegal,
    serbia,
    seychelles,
    sierra-leone,
    singapore,
    slovakia,
    slovenia,
    solomon-islands,
    somalia,
    south-africa,
    south-sudan,
    spain,
    sri-lanka,
    sudan,
    suriname,
    swaziland,
    sweden,
    switzerland,
    syria,
    taiwan,
    tajikistan,
    tanzania,
    thailand,
    timor-leste,
    togo,
    trinidad-and-tobago,
    tunisia,
    turkey,
    uganda,
    ukraine,
    united-arab-emirates,
    united-kingdom,
    united-states,
    uruguay,
    uzbekistan,
    vanuatu,
    venezuela,
    vietnam,
    western-sahara,
    yemen,
    zambia,
    zimbabwe.
    Veja ainda o \`${config.prefix}corona\`.`
}